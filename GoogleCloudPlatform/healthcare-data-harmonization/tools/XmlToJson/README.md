# XmlToJson tool

The XmlToJson tool, is intended to convert Clinical Document Architecture (CDA)
XML files to JSON.

## Summary

The XmlToJson is a first stage parser, which is in charge of parsing CCDA XML
files to JSON files. The key component of this tool is the
[JAXB library](https://docs.oracle.com/javase/tutorial/jaxb/intro/index.html).

This library allows the XmlToJson tool to unmarshal XML files into JAVA objects
and then marshall them back as JSON. The JAVA classes defining the unmarshalled
objects are generated by the
[XJC tool](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/xjc.html).

The XJC tool generates the JAVA classes based on the XSD schema defining the XML
files to be unmarshalled; in our case the schemas of interest correspond to the
different
[CCDA](http://www.hl7.org/implement/standards/product_brief.cfm?product_id=492)
revisions.

## How to build

### Dependencies

The following dependencies should be installed and available in the path of the
system:

Dependency  | Tested versions
------- | --------
[XJC](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/xjc.html) | `2.2.8-b130911.1802` `2.2.8-b130911.1802`

### Schemas

Only
[HL7 v3 CCDA Release 2](https://www.hl7.org/implement/standards/product_brief.cfm?product_id=7)
is currently supported, although the tool can be easily extended to support
additional versions.

NOTE: This repository does not contain the CCDA XSD schema files, which must be
obtained directly from HL7 (https://hl7.org).

The genccdarev2classes.sh script generates Java classes from the HL7v3 CCDA
XSDs, which also relies on the provided ccdarev2_binding.xml binding file. The
script and binding files look for the XSD files in the following directory:

../hl7v3xsd/cda_r2_normativewebedition2010/infrastructure/cda

Simply unzipping the cda_r2_normativewebedition2010.zip package in the
../hl7v3xsd directory will result in the correct directory structure.

Alternatively, you can use CCDA XSDs in a different location by making the
following two changes:

1.  Modify the *'schema'* variable found at the top of
    **genccdarev2classes.sh** script by setting it to the location of your
    CDA.xsd file:

    ```
        schema="yourLocation/CDA.xsd"
    ```

2.  Modify the provided **ccdarev2_binding.xml** file so that the binding for
    *CCDA POCD_MT000040.xsd* file has it's *schemaLocation* set to the correct
    location:

    ```
        <jaxb:bindings schemaLocation="yourLocation/POCD_MT000040.xsd">
    ```

The classes will only be generated if the root generated Java class
`xjcgen/ccdarev2/org/hl7/v3/POCDMT000040ClinicalDocument.java` does not exist.

### Build steps

After previous steps are ready, install Gradle making sure it is added to
`PATH`, then run the following:

```
gradle wrapper --gradle-version 6.1.1
./gradlew build
```
